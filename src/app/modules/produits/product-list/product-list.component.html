<div class="product-list-container">
  <h1 class="page-title">Nos Produits</h1>

  <!-- Filtres -->
  <div class="filters-container">
    <div class="filter-block">
      <label for="category">Catégorie :</label>
      <select id="category" [(ngModel)]="selectedCategory" (change)="applyFilters()">
        <option value="">Toutes</option>
        <option *ngFor="let cat of categories" [value]="cat.name">{{ cat.name }}</option>
      </select>
    </div>

    <div class="filter-block">
      <label for="priceMax">Prix max (€) :</label>
      <input
        id="priceMax"
        type="number"
        [(ngModel)]="priceMax"
        min="0"
        step="1"
        (input)="applyFilters()"
        placeholder="Ex: 25"
      />
    </div>

    <button class="apply-filter-btn" type="button" (click)="clearFilters()">Réinitialiser</button>
  </div>

  <!-- Liste des produits -->
  <div class="products-grid">
    <mat-card
      class="product-card"
      *ngFor="let product of filteredProducts"
      (click)="openPopup(product)"
    >
      <span class="badge" *ngIf="product.isNew">Nouveau</span>
      <img mat-card-image [src]="product.imageUrl" [alt]="product.name" />

      <mat-card-content>
        <h2 class="product-name">{{ product.name }}</h2>
        <p class="product-description">{{ product.description }}</p>
        <p class="product-category">Catégorie : {{ product.category }}</p>
        <p class="product-stock" [class.out-of-stock]="product.stockQuantity === 0">
          Stock : {{ product.stockQuantity === 0 ? 'Rupture' : product.stockQuantity }}
        </p>
        <p class="product-price">{{ product.price | currency: 'EUR' }}</p>
        <p *ngIf="product.rating !== undefined" class="product-rating">
          Note :
          <ng-container *ngFor="let star of [1,2,3,4,5]">
            <mat-icon>{{ star <= product.rating ? 'star' : 'star_border' }}</mat-icon>
          </ng-container>
        </p>
      </mat-card-content>

      <!-- Actions (modifier, supprimer) -->
      <mat-card-actions (click)="$event.stopPropagation()">
        <button mat-icon-button color="primary" (click)="goToEdit(product); $event.stopPropagation()">
          <mat-icon>edit</mat-icon>
        </button>

        <button mat-icon-button color="warn" (click)="onDelete(product); $event.stopPropagation()">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Popup détails produit -->
  <div class="popup-overlay" *ngIf="selectedProduct" (click)="closePopup()">
    <div class="popup-card" (click)="$event.stopPropagation()">
      <img [src]="selectedProduct.imageUrl" [alt]="selectedProduct.name" />
      <div class="popup-info">
        <h2>{{ selectedProduct.name }}</h2>
        <p class="popup-description">{{ selectedProduct.description }}</p>
        <p><strong>Catégorie :</strong> {{ selectedProduct.category }}</p>
        <p><strong>Prix :</strong> {{ selectedProduct.price | currency: 'EUR' }}</p>
        <p><strong>Stock :</strong> {{ selectedProduct.stockQuantity === 0 ? 'Rupture' : selectedProduct.stockQuantity }}</p>
        <p *ngIf="selectedProduct.rating !== undefined">
          <strong>Note :</strong>
          <ng-container *ngFor="let star of [1,2,3,4,5]">
            <mat-icon>{{ star <= selectedProduct.rating ? 'star' : 'star_border' }}</mat-icon>
          </ng-container>
        </p>
        <button class="close-btn" type="button" (click)="closePopup()">Fermer</button>
      </div>
    </div>
  </div>
</div>
